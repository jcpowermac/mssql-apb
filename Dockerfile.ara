FROM ansibleplaybookbundle/apb-base:canary

LABEL "com.redhat.apb.spec"=\
"LS0tCnZlcnNpb246IDEuMApuYW1lOiBtc3NxbC1hcGIKZGVzY3JpcHRpb246IEFQQiB0byBkZXBs\
b3kgTWljcm9zb2Z0IFNRTCBTZXJ2ZXIgb24gTGludXggMjAxNwpiaW5kYWJsZTogdHJ1ZQphc3lu\
Yzogb3B0aW9uYWwKbWV0YWRhdGE6CiAgZGlzcGxheU5hbWU6IE1TIFNRTCBTZXJ2ZXIgb24gTGlu\
dXggKEFQQikKICBpbWFnZVVybDoKICAgIGh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNv\
bS9hbnNpYmxlcGxheWJvb2tidW5kbGUvbXNzcWwtYXBiL21hc3Rlci9kb2NzL2ltZy9zcWwtc2Vy\
dmVyLnBuZwogIGRvY3VtZW50YXRpb25Vcmw6CiAgICBodHRwczovL2RvY3MubWljcm9zb2Z0LmNv\
bS9lbi11cy9zcWwvbGludXgvc3FsLXNlcnZlci1saW51eC1vdmVydmlldwogIGRlcGVuZGVuY2ll\
czogWydkb2NrZXIuaW8vdGNodWdoZXNpdi9tc3NxbC1zZXJ2ZXItbGludXgnXQp0YWdzOgogIC0g\
ZGF0YWJhc2UKICAtIG1zc3FsCnBsYW5zOgogIC0gbmFtZTogZXBoZW1lcmFsCiAgICBkZXNjcmlw\
dGlvbjogVGhpcyBwbGFuIGRlcGxveXMgYW4gZXBoZW1lcmFsIE1TIFNRTCBTZXJ2ZXIuCiAgICBm\
cmVlOiB0cnVlCiAgICBkZWZhdWx0OiB0cnVlCiAgICBtZXRhZGF0YToKICAgICAgZGlzcGxheU5h\
bWU6IEVwaGVtZXJhbCBpbnN0YWxsYXRpb24KICAgICAgbG9uZ0Rlc2NyaXB0aW9uOgogICAgICAg\
IFRoaXMgcGxhbiB3aWxsIGRlcGxveSBhIHN0YW5kYWxvbmUgTVMgU1FMIFNlcnZlciBvbiBMaW51\
eAogICAgICAgIHVzaW5nIGVwaGVtZXJhbCBzdG9yYWdlCiAgICBwYXJhbWV0ZXJzOgogICAgICAt\
IG5hbWU6IE1TU1FMX1BBU1NXT1JECiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZh\
dWx0OiAiSGVsbG8xMjMhIgogICAgICAgIHBhdHRlcm46ICJeKD86KD86W2Etel0rLipbQS1aXSsu\
KihcXGR8XFxXKSsuKilcCiAgICAgICAgICB8KD86W0EtWl0rLipbYS16XSsuKihcXGR8XFxXKSsu\
KilcCiAgICAgICAgICB8KD86KFxcZHxcXFcpKy4qW2Etel0uKltBLVpdLiopfCg/OihcXGR8XFxX\
KSsuKltBLVpdKy4qW2Etel0rLiopXAogICAgICAgICAgfCg/OltBLVpdKy4qKFxcZHxcXFcpKy4q\
W2Etel0rLiopfCg/OlthLXpdKy4qKFxcZHxcXFcpKy4qW0EtWl0rLiopXAogICAgICAgICAgfCg/\
OlxcZCsuKlxcVysuKihbQS1aXXxbYS16XSkrLiopfCg/OlxcVysuKlxcZCsuKihbQS1aXXxbYS16\
XSkrLiopXAogICAgICAgICAgfCg/OihbQS1aXXxbYS16XSkrLipcXGQrLipcXFcrLiopfCg/Oihb\
QS1aXXxbYS16XSkrLipcXFcrLipcXGQrLiopXAogICAgICAgICAgfCg/OlxcVysuKihbQS1aXXxb\
YS16XSkrLipcXGQrLiopfCg/OlxcZCsuKihbQS1aXXxbYS16XSkrLipcXFcrLiopKSQiCiAgICAg\
ICAgdHlwZTogc3RyaW5nCiAgICAgICAgZGlzcGxheV90eXBlOiBwYXNzd29yZAogICAgICAgIHRp\
dGxlOiAiUGFzc3dvcmQgZm9yIHRoZSBkYXRhYmFzZSBhZG1pbiAoU0EpIHVzZXIuIgogICAgICAg\
IGRlc2NyaXB0aW9uOgogICAgICAgICAgIlRoZSBwYXNzd29yZCBtdXN0IGJlIGF0IGxlYXN0IDgg\
Y2hhcmFjdGVycyBsb25nIGFuZCBjb250YWluCiAgICAgICAgICBjaGFyYWN0ZXJzIGZyb20gdGhy\
ZWUgb2YgdGhlIGZvbGxvd2luZyBmb3VyIHNldHM6IFVwcGVyY2FzZQogICAgICAgICAgbGV0dGVy\
cywgTG93ZXJjYXNlIGxldHRlcnMsIEJhc2UgMTAgZGlnaXRzLCBhbmQgU3ltYm9scy4iCiAgICAg\
ICAgZGlzcGxheV9ncm91cDogTVMgU1FMIENvbmZpZwogICAgICAgIG1pbl9sZW5ndGg6IDgKICAg\
ICAgICBtYXhfbGVuZ3RoOiAxMjgKICAgICAgLSBuYW1lOiBNU1NRTF9EQVRBQkFTRQogICAgICAg\
IHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGVmYXVsdDogVGVzdERCCiAgICAgICAgcGF0dGVybjog\
Il5bYS16QS1aMC05Xy1dKiQiCiAgICAgICAgdHlwZTogc3RyaW5nCiAgICAgICAgdGl0bGU6IE5h\
bWUgb2YgdGhlIE1TIFNRTCBkYXRhYmFzZSB0byBjcmVhdGUuCiAgICAgICAgZGlzcGxheV9ncm91\
cDogTVMgU1FMIENvbmZpZwogICAgICAtIG5hbWU6IE1TU1FMX0FHRU5UX0VOQUJMRUQKICAgICAg\
ICB0aXRsZTogRW5hYmxlIFNRTCBTZXJ2ZXIgQWdlbnQuCiAgICAgICAgdHlwZTogYm9vbGVhbgog\
ICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGVmYXVsdDogZmFsc2UKICAgICAgICBkZXNj\
cmlwdGlvbjogQnkgZGVmYXVsdCwgYWdlbnQgaXMgZGlzYWJsZWQuCiAgICAgICAgZGlzcGxheV9n\
cm91cDogTVMgU1FMIENvbmZpZwogICAgICAtIG5hbWU6IE1TU1FMX1BJRAogICAgICAgIHJlcXVp\
cmVkOiB0cnVlCiAgICAgICAgdHlwZTogZW51bQogICAgICAgIGVudW06IFsnRGV2ZWxvcGVyJywg\
J0V2YWx1YXRpb24nXQogICAgICAgIGRlZmF1bHQ6IERldmVsb3BlcgogICAgICAgIHRpdGxlOiBT\
ZXQgdGhlIFNRTCBTZXJ2ZXIgZWRpdGlvbi4KICAgICAgICBkaXNwbGF5X2dyb3VwOiBNUyBTUUwg\
Q29uZmlnCiAgICAgIC0gbmFtZTogTVNTUUxfTE9DQUxfSVMKICAgICAgICB0aXRsZTogVXNlIGV4\
aXN0aW5nIG1zc3FsLXNlcnZlci1saW51eCBpbWFnZXN0cmVhbSBpbiBwcm9qZWN0LgogICAgICAg\
IHR5cGU6IGJvb2xlYW4KICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6IGZh\
bHNlCiAgICAgICAgZGlzcGxheV9ncm91cDogTVMgU1FMIENvbmZpZwogICAgICAtIG5hbWU6IE1T\
U1FMX0xDSUQKICAgICAgICB0aXRsZTogU2V0IHRoZSBsYW5ndWFnZSBJRC4KICAgICAgICB0eXBl\
OiBpbnRlZ2VyCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZhdWx0OiAxMDMzCiAg\
ICAgICAgZGVzY3JpcHRpb246IEZvciBleGFtcGxlIC0gMTAzMyBpcyBFbmdsaXNoIChVUyksIDEw\
MzYgaXMgRnJlbmNoLgogICAgICAgIG1pbl9sZW5ndGg6IDQKICAgICAgICBtYXhfbGVuZ3RoOiA0\
CiAgICAgICAgZGlzcGxheV9ncm91cDogTVMgU1FMIENvbmZpZwogICAgICAtIG5hbWU6IE1TU1FM\
X0lNQUdFX1BVTEwKICAgICAgICB0aXRsZTogIkRlcGxveW1lbnRDb25maWcgSW1hZ2UgcHVsbCBw\
b2xpY3kiCiAgICAgICAgdHlwZTogZW51bQogICAgICAgIGVudW06IFsnQWx3YXlzJywgJ0lmTm90\
UHJlc2VudCcsICdOZXZlciddCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZhdWx0\
OiBJZk5vdFByZXNlbnQKICAgICAgICBkaXNwbGF5X2dyb3VwOiBNUyBTUUwgQ29uZmlnCiAgICAg\
IC0gbmFtZTogTVNTUUxfTUVNT1JZX0xJTUlUCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAg\
ICBkZWZhdWx0OiAzCiAgICAgICAgdHlwZTogaW50ZWdlcgogICAgICAgIHRpdGxlOgogICAgICAg\
ICAgTWF4aW11bSBhbW91bnQgb2YgbWVtb3J5IHRoZSBjb250YWluZXIgY2FuIHVzZSAoaW4gR0Ip\
IGVnIDFHQiAyR0IKICAgICAgICBkaXNwbGF5X2dyb3VwOiBFbnZpcm9ubWVudCBTaXppbmcKICAg\
ICAgLSBuYW1lOiBNU1NRTF9NRU1PUllfUkVRVUVTVAogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAg\
ICAgICAgZGVmYXVsdDogMgogICAgICAgIHR5cGU6IGludGVnZXIKICAgICAgICB0aXRsZToKICAg\
ICAgICAgIFJlcXVlc3RlZCBhbW91bnQgb2YgbWVtb3J5IGZvciB0aGUgY29udGFpbmVyIHRvIHN0\
YXJ0IChpbiBHQikKICAgICAgICAgIGVnIDFHQiAyR0IKICAgICAgICBkaXNwbGF5X2dyb3VwOiBF\
bnZpcm9ubWVudCBTaXppbmcKCiAgLSBuYW1lOiBwZXJzaXN0ZW50CiAgICBkZXNjcmlwdGlvbjog\
VGhpcyBwbGFuIGRlcGxveXMgYSBwZXJzaXN0ZW50IE1TIFNRTCBTZXJ2ZXIuCiAgICBmcmVlOiB0\
cnVlCiAgICBtZXRhZGF0YToKICAgICAgZGlzcGxheU5hbWU6IFBlcnNpc3RlbnQgaW5zdGFsbGF0\
aW9uCiAgICAgIGxvbmdEZXNjcmlwdGlvbjoKICAgICAgICBUaGlzIHBsYW4gd2lsbCBkZXBsb3kg\
YSBzdGFuZGFsb25lIE1TIFNRTCBTZXJ2ZXIgb24gTGludXgKICAgICAgICB1c2luZyBwZXJzaXN0\
ZW50IHN0b3JhZ2UKICAgIHBhcmFtZXRlcnM6CiAgICAgIC0gbmFtZTogTVNTUUxfUEFTU1dPUkQK\
ICAgICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6ICJIZWxsbzEyMyEiCiAgICAg\
ICAgcGF0dGVybjogIl4oPzooPzpbYS16XSsuKltBLVpdKy4qKFxcZHxcXFcpKy4qKVwKICAgICAg\
ICAgIHwoPzpbQS1aXSsuKlthLXpdKy4qKFxcZHxcXFcpKy4qKVwKICAgICAgICAgIHwoPzooXFxk\
fFxcVykrLipbYS16XS4qW0EtWl0uKil8KD86KFxcZHxcXFcpKy4qW0EtWl0rLipbYS16XSsuKilc\
CiAgICAgICAgICB8KD86W0EtWl0rLiooXFxkfFxcVykrLipbYS16XSsuKil8KD86W2Etel0rLioo\
XFxkfFxcVykrLipbQS1aXSsuKilcCiAgICAgICAgICB8KD86XFxkKy4qXFxXKy4qKFtBLVpdfFth\
LXpdKSsuKil8KD86XFxXKy4qXFxkKy4qKFtBLVpdfFthLXpdKSsuKilcCiAgICAgICAgICB8KD86\
KFtBLVpdfFthLXpdKSsuKlxcZCsuKlxcVysuKil8KD86KFtBLVpdfFthLXpdKSsuKlxcVysuKlxc\
ZCsuKilcCiAgICAgICAgICB8KD86XFxXKy4qKFtBLVpdfFthLXpdKSsuKlxcZCsuKil8KD86XFxk\
Ky4qKFtBLVpdfFthLXpdKSsuKlxcVysuKikpJCIKICAgICAgICB0eXBlOiBzdHJpbmcKICAgICAg\
ICBkaXNwbGF5X3R5cGU6IHBhc3N3b3JkCiAgICAgICAgdGl0bGU6ICJQYXNzd29yZCBmb3IgdGhl\
IGRhdGFiYXNlIGFkbWluIChTQSkgdXNlci4iCiAgICAgICAgZGVzY3JpcHRpb246CiAgICAgICAg\
ICAiVGhlIHBhc3N3b3JkIG11c3QgYmUgYXQgbGVhc3QgOCBjaGFyYWN0ZXJzIGxvbmcgYW5kIGNv\
bnRhaW4KICAgICAgICAgIGNoYXJhY3RlcnMgZnJvbSB0aHJlZSBvZiB0aGUgZm9sbG93aW5nIGZv\
dXIgc2V0czogVXBwZXJjYXNlCiAgICAgICAgICBsZXR0ZXJzLCBMb3dlcmNhc2UgbGV0dGVycywg\
QmFzZSAxMCBkaWdpdHMsIGFuZCBTeW1ib2xzLiIKICAgICAgICBkaXNwbGF5X2dyb3VwOiBNUyBT\
UUwgQ29uZmlnCiAgICAgICAgbWluX2xlbmd0aDogOAogICAgICAgIG1heF9sZW5ndGg6IDEyOAog\
ICAgICAtIG5hbWU6IE1TU1FMX0RBVEFCQVNFCiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAg\
ICBkZWZhdWx0OiBUZXN0REIKICAgICAgICBwYXR0ZXJuOiAiXlthLXpBLVowLTlfLV0qJCIKICAg\
ICAgICB0eXBlOiBzdHJpbmcKICAgICAgICB0aXRsZTogTmFtZSBvZiB0aGUgTVMgU1FMIGRhdGFi\
YXNlIHRvIGNyZWF0ZS4KICAgICAgICBkaXNwbGF5X2dyb3VwOiBNUyBTUUwgQ29uZmlnCiAgICAg\
IC0gbmFtZTogTVNTUUxfQUdFTlRfRU5BQkxFRAogICAgICAgIHRpdGxlOiBFbmFibGUgU1FMIFNl\
cnZlciBBZ2VudC4KICAgICAgICB0eXBlOiBib29sZWFuCiAgICAgICAgcmVxdWlyZWQ6IHRydWUK\
ICAgICAgICBkZWZhdWx0OiBmYWxzZQogICAgICAgIGRlc2NyaXB0aW9uOiBCeSBkZWZhdWx0LCBh\
Z2VudCBpcyBkaXNhYmxlZC4KICAgICAgICBkaXNwbGF5X2dyb3VwOiBNUyBTUUwgQ29uZmlnCiAg\
ICAgIC0gbmFtZTogTVNTUUxfUElECiAgICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICB0eXBl\
OiBlbnVtCiAgICAgICAgZW51bTogWydEZXZlbG9wZXInLCAnRXZhbHVhdGlvbiddCiAgICAgICAg\
ZGVmYXVsdDogRGV2ZWxvcGVyCiAgICAgICAgdGl0bGU6IFNldCB0aGUgU1FMIFNlcnZlciBlZGl0\
aW9uLgogICAgICAgIGRpc3BsYXlfZ3JvdXA6IE1TIFNRTCBDb25maWcKICAgICAgLSBuYW1lOiBN\
U1NRTF9MT0NBTF9JUwogICAgICAgIHRpdGxlOiBVc2UgZXhpc3RpbmcgbXNzcWwtc2VydmVyLWxp\
bnV4IGltYWdlc3RyZWFtIGluIHByb2plY3QuCiAgICAgICAgdHlwZTogYm9vbGVhbgogICAgICAg\
IHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGVmYXVsdDogZmFsc2UKICAgICAgICBkaXNwbGF5X2dy\
b3VwOiBNUyBTUUwgQ29uZmlnCiAgICAgIC0gbmFtZTogTVNTUUxfTENJRAogICAgICAgIHRpdGxl\
OiBTZXQgdGhlIGxhbmd1YWdlIElELgogICAgICAgIHR5cGU6IGludGVnZXIKICAgICAgICByZXF1\
aXJlZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6IDEwMzMKICAgICAgICBkZXNjcmlwdGlvbjogRm9y\
IGV4YW1wbGUgLSAxMDMzIGlzIEVuZ2xpc2ggKFVTKSwgMTAzNiBpcyBGcmVuY2guCiAgICAgICAg\
bWluX2xlbmd0aDogNAogICAgICAgIG1heF9sZW5ndGg6IDQKICAgICAgICBkaXNwbGF5X2dyb3Vw\
OiBNUyBTUUwgQ29uZmlnCiAgICAgIC0gbmFtZTogTVNTUUxfSU1BR0VfUFVMTAogICAgICAgIHRp\
dGxlOiAiRGVwbG95bWVudENvbmZpZyBJbWFnZSBwdWxsIHBvbGljeSIKICAgICAgICB0eXBlOiBl\
bnVtCiAgICAgICAgZW51bTogWydBbHdheXMnLCAnSWZOb3RQcmVzZW50JywgJ05ldmVyJ10KICAg\
ICAgICByZXF1aXJlZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6IElmTm90UHJlc2VudAogICAgICAg\
IGRpc3BsYXlfZ3JvdXA6IE1TIFNRTCBDb25maWcKICAgICAgLSBuYW1lOiBNU1NRTF9EQVRBX1NU\
T1JBR0VfU0laRQogICAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgICAgZGVmYXVsdDogMQogICAg\
ICAgIHR5cGU6IGludGVnZXIKICAgICAgICB0aXRsZTogUGVyc2lzdGVudCB2b2x1bWUgc2l6ZSBm\
b3IgZGIgZGF0YSAoaW4gR0IpIGVnIDFHQiAyR0IKICAgICAgICBkaXNwbGF5X2dyb3VwOiBFbnZp\
cm9ubWVudCBTaXppbmcKICAgICAgLSBuYW1lOiBNU1NRTF9NRU1PUllfTElNSVQKICAgICAgICBy\
ZXF1aXJlZDogdHJ1ZQogICAgICAgIGRlZmF1bHQ6IDMKICAgICAgICB0eXBlOiBpbnRlZ2VyCiAg\
ICAgICAgdGl0bGU6CiAgICAgICAgICBNYXhpbXVtIGFtb3VudCBvZiBtZW1vcnkgdGhlIGNvbnRh\
aW5lciBjYW4gdXNlIChpbiBHQikgZWcgMUdCIDJHQgogICAgICAgIGRpc3BsYXlfZ3JvdXA6IEVu\
dmlyb25tZW50IFNpemluZwogICAgICAtIG5hbWU6IE1TU1FMX01FTU9SWV9SRVFVRVNUCiAgICAg\
ICAgcmVxdWlyZWQ6IHRydWUKICAgICAgICBkZWZhdWx0OiAyCiAgICAgICAgdHlwZTogaW50ZWdl\
cgogICAgICAgIHRpdGxlOgogICAgICAgICAgUmVxdWVzdGVkIGFtb3VudCBvZiBtZW1vcnkgZm9y\
IHRoZSBjb250YWluZXIgdG8gc3RhcnQgKGluIEdCKQogICAgICAgICAgZWcgMUdCIDJHQgogICAg\
ICAgIGRpc3BsYXlfZ3JvdXA6IEVudmlyb25tZW50IFNpemluZwo="

COPY playbooks /opt/apb/actions
COPY roles /opt/ansible/roles
RUN chown -R apb:0 /opt/{ansible,apb} && \
    chmod -R g=u /opt/{ansible,apb}

USER root
RUN yum install -y python-psycopg2 && \
    pip install ara && \
    yum clean all

USER apb

ENV IPADDR="172.31.51.52"

ENV ARA_DATABASE="postgresql+psycopg2://ara:password@${IPADDR}:32345/ara" \
    ARA_BASE="/usr/lib/python2.7/site-packages/ara"

ENV ANSIBLE_CALLBACK_PLUGINS=${ARA_BASE}/plugins/callbacks \
    ANSIBLE_ACTION_PLUGINS=${ARA_BASE}/plugins/actions \
    ANSIBLE_LIBRARY=${ARA_BASE}/plugins/modules

